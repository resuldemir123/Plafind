@using System.Globalization
@model Plafind.ViewModels.BusinessDetailsViewModel
@{
    var business = Model.Business;
    ViewData["Title"] = $"{business.Name} - İşletme Detayları";
    var hasImage = !string.IsNullOrWhiteSpace(business.ImageUrl);
    var hasLocation = business.Latitude.HasValue && business.Longitude.HasValue;
    var locationLat = hasLocation ? business.Latitude!.Value.ToString(CultureInfo.InvariantCulture) : string.Empty;
    var locationLng = hasLocation ? business.Longitude!.Value.ToString(CultureInfo.InvariantCulture) : string.Empty;
    var heroBackground = hasImage
        ? $"background-image: linear-gradient(135deg, rgba(7,17,38,0.92) 0%, rgba(7,17,38,0.6) 50%, rgba(7,17,38,0.95) 100%), url('{business.ImageUrl}');"
        : string.Empty;
}
@Html.AntiForgeryToken()

<section class="business-hero @(hasImage ? "with-image" : "no-image")" style="@heroBackground">
    <div class="hero-overlay">
        <div class="container">
            <nav aria-label="breadcrumb" class="hero-breadcrumb">
                <ol class="breadcrumb mb-3">
                    <li class="breadcrumb-item"><a asp-controller="Home" asp-action="Index">Ana Sayfa</a></li>
                    <li class="breadcrumb-item"><a asp-controller="Home" asp-action="Search">İşletmeler</a></li>
                    <li class="breadcrumb-item active" aria-current="page">@business.Name</li>
                </ol>
            </nav>

            <div class="hero-content row g-4 align-items-center">
                <div class="col-lg-7">
                    <div class="hero-heading">
                        <h1 class="hero-title">@business.Name</h1>
                        @if (business.IsFeatured)
                        {
                            <span class="hero-badge">
                                <i class="fas fa-star me-1"></i>Öne Çıkan İşletme
                            </span>
                        }
                    </div>

                    <div class="hero-rating">
                        <div class="score">@business.AverageRating.ToString("F1")</div>
                        <div class="stars">
                            @for (int i = 1; i <= 5; i++)
                            {
                                <i class="@(i <= Math.Round(business.AverageRating) ? "fas" : "far") fa-star"></i>
                            }
                        </div>
                        <span class="rating-count">@business.TotalReviews değerlendirme</span>
                    </div>

                    <div class="hero-tags">
                        <span class="tag tag-category">
                            <i class="fas fa-tag me-1"></i>@(business.Category?.Name ?? "Kategori Yok")
                        </span>
                        @if (!string.IsNullOrEmpty(business.PriceRange))
                        {
                            <span class="tag tag-price">
                                <i class="fas fa-dollar-sign me-1"></i>@business.PriceRange
                            </span>
                        }
                    </div>

                    <div class="hero-actions">
                        @if (!string.IsNullOrEmpty(business.Phone))
                        {
                            <a href="tel:@business.Phone" class="hero-btn hero-btn--call">
                                <i class="fas fa-phone me-2"></i>Ara
                            </a>
                        }
                        @if (!string.IsNullOrEmpty(business.Email))
                        {
                            <a href="mailto:@business.Email" class="hero-btn hero-btn--email">
                                <i class="fas fa-envelope me-2"></i>E-posta
                            </a>
                        }
                        @if (!string.IsNullOrEmpty(business.Website))
                        {
                            <a href="@business.Website" target="_blank" class="hero-btn hero-btn--website">
                                <i class="fas fa-external-link-alt me-2"></i>Website
                            </a>
                        }
                        @if (User.Identity?.IsAuthenticated == true)
                        {
                            @if (!User.IsInRole("Admin") && !User.IsInRole("BusinessOwner"))
                            {
                                <a asp-controller="Reservations" asp-action="Create" asp-route-businessId="@business.Id" class="hero-btn hero-btn--reservation">
                                    <i class="fas fa-calendar-check me-2"></i>Rezervasyon Yap
                                </a>
                                <button class="hero-btn hero-btn--favorite favorite-btn" 
                                        data-business-id="@business.Id" 
                                        title="Favorilere ekle">
                                    <i class="far fa-heart"></i>
                                </button>
                            }
                        }
                        else
                        {
                            <a asp-controller="Reservations" asp-action="Create" asp-route-businessId="@business.Id" class="hero-btn hero-btn--reservation">
                                <i class="fas fa-calendar-check me-2"></i>Rezervasyon Yap
                            </a>
                        }
                    </div>
                </div>

                <div class="col-lg-5">
                    <div class="hero-meta">
                        @if (!string.IsNullOrEmpty(business.WorkingHours))
                        {
                            <div class="meta-card">
                                <span class="meta-icon text-info"><i class="fas fa-clock"></i></span>
                                <div>
                                    <p class="meta-label">Çalışma Saatleri</p>
                                    <p class="meta-value">@business.WorkingHours</p>
                                </div>
                            </div>
                        }
                        <div class="meta-card">
                            <span class="meta-icon text-warning"><i class="fas fa-star"></i></span>
                            <div>
                                <p class="meta-label">Değerlendirme</p>
                                <p class="meta-value">@business.TotalReviews yorum</p>
                            </div>
                        </div>
                        @if (!string.IsNullOrEmpty(business.Address))
                        {
                            <div class="meta-card">
                                <span class="meta-icon text-danger"><i class="fas fa-map-marker-alt"></i></span>
                                <div>
                                    <p class="meta-label">Adres</p>
                                    <p class="meta-value">@business.Address</p>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<section class="business-content py-5">
    <div class="container">
        <div class="row g-4">
            <div class="col-lg-8">
                @if (hasImage)
                {
                    <div class="media-card mb-4">
                        <img src="@business.ImageUrl" alt="@business.Name" class="media-image" />
                        <div class="media-overlay">
                            <div>
                                <span class="media-label"><i class="fas fa-camera me-2"></i>Öne çıkan görsel</span>
                                <p class="media-title">@business.Name</p>
                            </div>
                        </div>
                    </div>
                }

                <div class="info-grid mb-4">
                    <div class="info-card">
                        <span class="info-icon text-primary"><i class="fas fa-tags"></i></span>
                        <h6>Kategori</h6>
                        <p>@(business.Category?.Name ?? "Belirtilmemiş")</p>
                    </div>
                    <div class="info-card">
                        <span class="info-icon text-success"><i class="fas fa-dollar-sign"></i></span>
                        <h6>Fiyat Aralığı</h6>
                        <p>@(!string.IsNullOrEmpty(business.PriceRange) ? business.PriceRange : "Belirtilmemiş")</p>
                    </div>
                    <div class="info-card">
                        <span class="info-icon text-info"><i class="fas fa-phone"></i></span>
                        <h6>Telefon</h6>
                        <p>@(!string.IsNullOrEmpty(business.Phone) ? business.Phone : "Belirtilmemiş")</p>
                    </div>
                    <div class="info-card">
                        <span class="info-icon text-warning"><i class="fas fa-clock"></i></span>
                        <h6>Çalışma Saatleri</h6>
                        <p>@(!string.IsNullOrEmpty(business.WorkingHours) ? business.WorkingHours : "Belirtilmemiş")</p>
                    </div>
                </div>

                @if (!string.IsNullOrEmpty(business.Description))
                {
                    <div class="section-card mb-4">
                        <div class="section-header">
                            <i class="fas fa-info-circle me-2 text-warning"></i>
                            <h3 class="section-title">İşletme Hakkında</h3>
                        </div>
                        <p class="section-text">@business.Description</p>
                    </div>
                }

                <div class="section-card mb-4">
                    <div class="section-header">
                        <i class="fas fa-comments me-2 text-warning"></i>
                        <h3 class="section-title">Yorumlar</h3>
                        <span class="badge bg-warning text-dark ms-auto">@business.TotalReviews</span>
                    </div>

                    @if (business.Reviews != null && business.Reviews.Any(r => r.IsActive))
                    {
                        <div class="reviews-list">
                            @foreach (var review in business.Reviews.Where(r => r.IsActive).OrderByDescending(r => r.CreatedDate).Take(5))
                            {
                                <div class="review-card">
                                    <div class="review-header">
                                        <div class="review-user">
                                            <div class="avatar"><i class="fas fa-user"></i></div>
                                            <div>
                                                <h6>@(review.User?.FullName ?? review.User?.UserName ?? "Anonim Kullanıcı")</h6>
                                                <div class="review-stars">
                                                    @for (int i = 1; i <= 5; i++)
                                                    {
                                                        <i class="@(i <= review.Rating ? "fas" : "far") fa-star"></i>
                                                    }
                                                </div>
                                            </div>
                                        </div>
                                        <span class="review-date">@review.CreatedDate.ToString("dd MMMM yyyy")</span>
                                    </div>
                                    @if (!string.IsNullOrEmpty(review.Comment))
                                    {
                                        <p class="review-text">@review.Comment</p>
                                    }
                                </div>
                            }
                        </div>

                        @if (business.TotalReviews > 5)
                        {
                            <div class="text-center mt-4">
                                <button class="btn btn-outline-primary rounded-pill px-4">
                                    Tüm yorumları görüntüle (@business.TotalReviews)
                                </button>
                            </div>
                        }
                    }
                    else
                    {
                        <div class="empty-state">
                            <i class="fas fa-comment-slash"></i>
                            <p>Henüz yorum yapılmamış.</p>
                            <span class="text-muted">İlk yorumu siz yapın!</span>
                        </div>
                    }

                    @if (User.Identity.IsAuthenticated && !User.IsInRole("Admin"))
                    {
                        <div class="mt-4">
                            <a asp-controller="Reviews" asp-action="Create" asp-route-businessId="@business.Id" class="btn btn-primary w-100">
                                <i class="fas fa-pen me-2"></i>Yorum Yap ve Puanla
                            </a>
                        </div>
                    }
                    else if (!User.Identity.IsAuthenticated)
                    {
                        <div class="alert alert-info mt-4">
                            <i class="fas fa-info-circle me-2"></i>
                            Yorum yapabilmek için <a asp-area="Identity" asp-page="/Account/Login" class="alert-link">giriş yapmalısınız</a>.
                        </div>
                    }
                </div>
            </div>

            <div class="col-lg-4">
                <div class="section-card sidebar-card">
                    <div class="section-header">
                        <i class="fas fa-address-book me-2 text-warning"></i>
                        <h3 class="section-title">İletişim Bilgileri</h3>
                    </div>

                    <div class="contact-list">
                        @if (!string.IsNullOrEmpty(business.Address))
                        {
                            <div class="contact-row">
                                <span class="contact-icon text-danger"><i class="fas fa-map-marker-alt"></i></span>
                                <div>
                                    <p class="contact-label">Adres</p>
                                    <p class="contact-value">@business.Address</p>
                                </div>
                            </div>
                        }
                        @if (!string.IsNullOrEmpty(business.Phone))
                        {
                            <div class="contact-row">
                                <span class="contact-icon text-success"><i class="fas fa-phone"></i></span>
                                <div>
                                    <p class="contact-label">Telefon</p>
                                    <a href="tel:@business.Phone" class="contact-action btn btn-success w-100">
                                        <i class="fas fa-phone-alt me-2"></i>@business.Phone
                                    </a>
                                </div>
                            </div>
                        }
                        @if (!string.IsNullOrEmpty(business.Email))
                        {
                            <div class="contact-row">
                                <span class="contact-icon text-warning"><i class="fas fa-envelope"></i></span>
                                <div>
                                    <p class="contact-label">E-posta</p>
                                    <a href="mailto:@business.Email" class="contact-link">@business.Email</a>
                                </div>
                            </div>
                        }
                        @if (!string.IsNullOrEmpty(business.Website))
                        {
                            <div class="contact-row">
                                <span class="contact-icon text-info"><i class="fas fa-globe"></i></span>
                                <div>
                                    <p class="contact-label">Website</p>
                                    <a href="@business.Website" target="_blank" class="contact-action btn btn-info text-white w-100">
                                        <i class="fas fa-external-link-alt me-2"></i>Websiteyi Ziyaret Et
                                    </a>
                                </div>
                            </div>
                        }
                    </div>

                    @if (User.IsInRole("Admin"))
                    {
                        <div class="admin-tools mt-4 pt-4 border-top border-secondary">
                            <h6 class="fw-bold text-danger mb-3">
                                <i class="fas fa-user-shield me-2"></i>Admin İşlemleri
                            </h6>
                            <div class="d-grid gap-2">
                                <a asp-action="Edit" asp-route-id="@business.Id" class="btn btn-warning">
                                    <i class="fas fa-edit me-2"></i>Düzenle
                                </a>
                                <a asp-action="Delete" asp-route-id="@business.Id" class="btn btn-danger"
                                   onclick="return confirm('Bu işletmeyi silmek istediğinizden emin misiniz?');">
                                    <i class="fas fa-trash me-2"></i>Sil
                                </a>
                            </div>
                        </div>
                    }
                </div>

                @if (hasLocation)
                {
                    <div class="section-card sidebar-card mt-4">
                        <div class="section-header">
                            <i class="fas fa-map-marked-alt me-2 text-warning"></i>
                            <h3 class="section-title">Konum</h3>
                        </div>
                        <div id="businessLocationMap"
                             class="business-map"
                             data-lat="@locationLat"
                             data-lng="@locationLng"
                             data-name="@business.Name">
                        </div>
                        <p class="map-note">
                            <i class="fas fa-info-circle me-1"></i> Harita üzerinden yakınlaştırarak işletmenin tam konumunu görebilirsiniz.
                        </p>
                    </div>
                }

                <div class="section-card sidebar-card">
                    <div class="section-header">
                        <i class="fas fa-share-alt me-2 text-warning"></i>
                        <h3 class="section-title">Paylaş</h3>
                    </div>
                    <div class="share-grid">
                        <button class="share-pill share-pill--facebook" title="Facebook" onclick="window.open('https://www.facebook.com/sharer/sharer.php?u=' + encodeURIComponent(window.location.href),'_blank')">
                            <i class="fab fa-facebook-f"></i>
                        </button>
                        <button class="share-pill share-pill--twitter" title="X (Twitter)" onclick="window.open('https://twitter.com/intent/tweet?url=' + encodeURIComponent(window.location.href),'_blank')">
                            <i class="fab fa-twitter"></i>
                        </button>
                        <button class="share-pill share-pill--whatsapp" title="WhatsApp" onclick="window.open('https://api.whatsapp.com/send?text=' + encodeURIComponent(window.location.href),'_blank')">
                            <i class="fab fa-whatsapp"></i>
                        </button>
                        <button class="share-pill share-pill--copy" title="Linki kopyala" onclick="copyToClipboard()">
                            <i class="fas fa-link"></i>
                        </button>
                    </div>
                </div>

                <a asp-controller="Home" asp-action="Search" class="btn btn-outline-secondary w-100">
                    <i class="fas fa-arrow-left me-2"></i>İşletmelere Geri Dön
                </a>
            </div>
        </div>
    </div>
</section>

@if (Model.SimilarBusinesses != null && Model.SimilarBusinesses.Any())
{
    <section class="similar-businesses py-5">
        <div class="container">
            <div class="section-card">
                <div class="section-header">
                    <i class="fas fa-clone me-2 text-warning"></i>
                    <h3 class="section-title">Benzer İşletmeler</h3>
                    <span class="badge bg-secondary ms-auto">@Model.SimilarBusinesses.Count</span>
                </div>
                <div class="similar-grid">
                    @foreach (var similar in Model.SimilarBusinesses)
                    {
                        var cover = string.IsNullOrWhiteSpace(similar.ImageUrl)
                            ? Url.Content("~/images/190_alanya.jpg")
                            : similar.ImageUrl;
                        <article class="similar-card">
                            <div class="similar-media" style="background-image: url('@cover');">
                                <span class="similar-category">@similar.Category?.Name</span>
                            </div>
                            <div class="similar-body">
                                <h4 class="similar-title">@similar.Name</h4>
                                <p class="similar-meta">
                                    <i class="fas fa-map-marker-alt me-1"></i>
                                    @(string.IsNullOrWhiteSpace(similar.Address) ? "Adres bilgisi yok" : similar.Address)
                                </p>
                                <div class="similar-rating">
                                    <span class="score">@similar.AverageRating.ToString("F1")</span>
                                    <span class="count">(@similar.TotalReviews)</span>
                                </div>
                                <a asp-controller="Businesses" asp-action="Details" asp-route-id="@similar.Id" class="btn btn-outline-warning w-100">
                                    İncele
                                </a>
                            </div>
                        </article>
                    }
                </div>
            </div>
        </div>
    </section>
}

<style>
    .business-hero {
        position: relative;
        padding: 4rem 0 3rem;
        background: linear-gradient(135deg, rgba(7,17,38,0.95), rgba(7,17,38,0.85));
        background-size: cover;
        background-position: center;
    }

    .business-hero .hero-overlay {
        backdrop-filter: blur(8px);
        background: rgba(7,17,38,0.65);
        padding: 1.5rem;
        border-radius: 1.5rem;
    }

    .business-hero .breadcrumb {
        background: transparent;
        padding: 0;
    }

    .business-hero .breadcrumb a {
        color: var(--accent);
    }

    .hero-title {
        font-size: clamp(2rem, 4vw, 3rem);
        font-weight: 800;
        margin-bottom: .75rem;
        color: #ffffff;
        text-shadow: 0 2px 10px rgba(0,0,0,0.4);
    }

    .hero-badge {
        display: inline-flex;
        align-items: center;
        gap: .5rem;
        padding: .5rem 1.2rem;
        border-radius: 999px;
        background: rgba(255,193,7,0.15);
        border: 1px solid rgba(255,193,7,0.35);
        color: var(--accent);
        font-weight: 600;
        letter-spacing: .02em;
    }

    .hero-rating {
        display: flex;
        align-items: center;
        gap: 1.5rem;
        margin: 1.5rem 0;
    }

    .hero-rating .score {
        font-size: clamp(3rem, 6vw, 4.5rem);
        font-weight: 800;
        color: var(--accent);
        line-height: 1;
    }

    .hero-rating .stars {
        display: flex;
        gap: .35rem;
        font-size: 1.5rem;
        color: var(--accent);
    }

    .hero-rating .rating-count {
        color: rgba(226,232,240,0.75);
        font-weight: 600;
        letter-spacing: .03em;
    }

    .hero-tags {
        display: flex;
        flex-wrap: wrap;
        gap: .9rem;
        margin-bottom: 1.5rem;
    }

    .hero-tags .tag {
        display: inline-flex;
        align-items: center;
        gap: .4rem;
        padding: .55rem 1.3rem;
        border-radius: 999px;
        font-weight: 600;
    }

    .tag-category {
        background: rgba(59,130,246,0.2);
        border: 1px solid rgba(59,130,246,0.4);
        color: #60a5fa;
    }

    .tag-price {
        background: rgba(34,197,94,0.2);
        border: 1px solid rgba(34,197,94,0.4);
        color: #4ade80;
    }

    .hero-actions {
        display: flex;
        flex-wrap: wrap;
        gap: .75rem;
    }

    .hero-btn {
        display: inline-flex;
        align-items: center;
        gap: .6rem;
        padding: .75rem 1.4rem;
        border-radius: .9rem;
        font-weight: 600;
        border: 1px solid transparent;
        transition: all .3s ease;
    }

    .hero-btn--call {
        background: rgba(34,197,94,0.18);
        border-color: rgba(34,197,94,0.35);
        color: #4ade80;
    }

    .hero-btn--email {
        background: rgba(245,158,11,0.18);
        border-color: rgba(245,158,11,0.35);
        color: #fbbf24;
    }

    .hero-btn--website {
        background: rgba(59,130,246,0.18);
        border-color: rgba(59,130,246,0.35);
        color: #60a5fa;
    }

    .hero-btn--favorite {
        background: rgba(220,38,38,0.18);
        border-color: rgba(220,38,38,0.35);
        color: #f87171;
    }

    .hero-btn--favorite.active {
        background: rgba(220,38,38,0.3);
        border-color: rgba(220,38,38,0.5);
        color: #ef4444;
    }

    .hero-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 12px 24px rgba(8,14,29,0.35);
    }

    .hero-meta {
        display: grid;
        gap: 1rem;
    }

    .meta-card {
        display: flex;
        gap: 1rem;
        align-items: center;
        padding: 1.2rem 1.4rem;
        border-radius: 1rem;
        background: rgba(15,23,42,0.65);
        border: 1px solid rgba(148,163,184,0.18);
    }

    .meta-icon {
        font-size: 1.75rem;
    }

    .meta-label {
        margin: 0;
        text-transform: uppercase;
        letter-spacing: .08em;
        font-size: .75rem;
        color: rgba(226,232,240,0.65);
    }

    .meta-value {
        margin: 0;
        font-weight: 600;
        color: #ffffff;
    }
    
    .meta-label {
        color: rgba(255,255,255,.8) !important;
    }

    .business-content {
        background: linear-gradient(180deg, rgba(7,12,25,0.95) 0%, rgba(7,12,25,0.7) 100%);
        color: #ffffff;
    }

    .section-card {
        background: rgba(17,24,39,0.78);
        border: 1px solid rgba(148,163,184,0.15);
        border-radius: 1.25rem;
        padding: 2rem;
        box-shadow: 0 24px 60px rgba(7,12,24,0.35);
    }

    .media-card {
        position: relative;
        border-radius: 1.5rem;
        overflow: hidden;
        box-shadow: 0 30px 60px rgba(7,12,24,0.4);
    }

    .media-image {
        width: 100%;
        height: 420px;
        object-fit: cover;
        transition: transform .5s ease;
    }

    .media-card:hover .media-image {
        transform: scale(1.05);
    }

    .media-overlay {
        position: absolute;
        inset: 0;
        background: linear-gradient(180deg, rgba(7,12,25,0) 0%, rgba(7,12,25,0.85) 100%);
        display: flex;
        align-items: flex-end;
        padding: 1.5rem;
    }

    .media-label {
        font-size: .85rem;
        text-transform: uppercase;
        letter-spacing: .08em;
        color: rgba(226,232,240,0.7);
    }

    .media-title {
        font-size: 1.25rem;
        margin: .35rem 0 0;
        color: var(--text);
        font-weight: 600;
    }

    .info-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: 1rem;
    }

    .info-card {
        background: rgba(15,23,42,0.7);
        border: 1px solid rgba(148,163,184,0.15);
        border-radius: 1rem;
        padding: 1.4rem;
        display: grid;
        gap: .35rem;
        transition: all .3s ease;
    }

    .info-card:hover {
        transform: translateY(-4px);
        border-color: rgba(255,193,7,0.25);
        box-shadow: 0 18px 40px rgba(8,13,23,0.4);
    }

    .info-icon {
        font-size: 1.6rem;
    }

    .info-card h6 {
        margin: .3rem 0;
        font-weight: 700;
        color: #ffffff;
    }

    .info-card p {
        margin: 0;
        color: rgba(255,255,255,.9);
    }

    .section-header {
        display: flex;
        align-items: center;
        gap: .75rem;
        border-bottom: 2px solid rgba(255,193,7,0.2);
        padding-bottom: 1rem;
        margin-bottom: 1.5rem;
    }

    .section-title {
        margin: 0;
        font-weight: 800;
        color: #ffffff;
        text-shadow: 0 1px 4px rgba(0,0,0,0.2);
    }

    .section-text {
        color: #ffffff;
        font-size: 1.05rem;
        line-height: 1.9;
        opacity: 0.95;
    }

    .reviews-list {
        display: grid;
        gap: 1.2rem;
    }

    .review-card {
        background: rgba(12,18,33,0.65);
        border: 1px solid rgba(148,163,184,0.12);
        border-radius: 1rem;
        padding: 1.5rem;
        transition: all .3s ease;
    }

    .review-card:hover {
        border-color: rgba(255,193,7,0.25);
        transform: translateY(-3px);
    }

    .review-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 1rem;
    }

    .review-user {
        display: flex;
        gap: 1rem;
        align-items: center;
    }

    .review-user h6 {
        margin: 0 0 .35rem;
        font-weight: 700;
        color: #ffffff;
    }

    .review-stars {
        color: var(--accent);
        font-size: .9rem;
    }

    .avatar {
        width: 48px;
        height: 48px;
        border-radius: 50%;
        background: rgba(255,193,7,0.18);
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--accent);
        font-size: 1.2rem;
    }

    .review-date {
        color: rgba(226,232,240,0.55);
        font-size: .9rem;
    }

    .review-text {
        margin: 0;
        color: rgba(255,255,255,.9);
        line-height: 1.75;
    }
    
    .review-date {
        color: rgba(255,255,255,.7) !important;
    }

    .empty-state {
        text-align: center;
        padding: 3rem 1rem;
        color: rgba(226,232,240,0.6);
        display: grid;
        gap: .5rem;
    }

    .empty-state i {
        font-size: 3.5rem;
    }

    .contact-list {
        display: grid;
        gap: 1.5rem;
    }

    .contact-row {
        display: flex;
        gap: 1rem;
        align-items: flex-start;
    }

    .contact-icon {
        font-size: 1.5rem;
        margin-top: .25rem;
    }

    .contact-label {
        margin: 0;
        font-weight: 600;
        color: #ffffff;
    }

    .contact-value {
        margin: .2rem 0 0;
        color: rgba(255,255,255,.85);
        line-height: 1.6;
    }

    .contact-link {
        color: var(--accent);
        text-decoration: none;
        font-weight: 600;
    }

    .contact-link:hover {
        color: #ffd166;
    }

    .contact-action {
        margin-top: .5rem;
    }

    .business-map {
        width: 100%;
        height: 240px;
        border-radius: 1rem;
        overflow: hidden;
        border: 1px solid rgba(148,163,184,0.2);
    }

    .map-note {
        margin-top: .75rem;
        color: rgba(226,232,240,0.65);
        font-size: .9rem;
    }

    .share-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: .75rem;
    }

    .share-pill {
        width: 100%;
        aspect-ratio: 1;
        border-radius: 1rem;
        border: none;
        background: rgba(15,23,42,0.7);
        color: var(--text);
        font-size: 1.35rem;
        transition: all .25s ease;
    }

    .share-pill:hover {
        transform: translateY(-4px);
        box-shadow: 0 16px 40px rgba(8,13,23,0.45);
    }

    .share-pill--facebook { color: #3b5998; }
    .share-pill--twitter { color: #1da1f2; }
    .share-pill--whatsapp { color: #25d366; }
    .share-pill--copy { color: #f59e0b; }

    .similar-businesses {
        background: linear-gradient(180deg, rgba(7,12,25,0.85) 0%, rgba(7,12,25,0.95) 100%);
    }

    .similar-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        gap: 1.5rem;
    }

    .similar-card {
        background: rgba(15,23,42,0.75);
        border: 1px solid rgba(148,163,184,0.15);
        border-radius: 1.25rem;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        box-shadow: 0 20px 45px rgba(7,12,24,0.4);
    }

    .similar-media {
        position: relative;
        height: 160px;
        background-size: cover;
        background-position: center;
    }

    .similar-category {
        position: absolute;
        top: 1rem;
        left: 1rem;
        background: rgba(0,0,0,0.6);
        padding: .4rem .9rem;
        border-radius: 999px;
        font-size: .85rem;
        color: var(--text);
    }

    .similar-body {
        padding: 1.6rem;
        display: flex;
        flex-direction: column;
        gap: .75rem;
    }

    .similar-title {
        margin: 0;
        font-size: 1.1rem;
        font-weight: 700;
        color: #ffffff;
    }

    .similar-meta {
        margin: 0;
        color: rgba(255,255,255,.85);
        font-size: .95rem;
    }

    .similar-rating {
        display: flex;
        align-items: baseline;
        gap: .4rem;
        color: var(--accent);
        font-weight: 700;
    }

    .similar-rating .count {
        font-size: .85rem;
        color: rgba(255,255,255,.8);
    }
    
    .media-title {
        color: #ffffff !important;
    }
    
    .media-label {
        color: rgba(255,255,255,.85) !important;
    }
    
    .empty-state {
        color: rgba(255,255,255,.8) !important;
    }
    
    .map-note {
        color: rgba(255,255,255,.8) !important;
    }

    @@media (max-width: 992px) {
        .hero-overlay {
            padding: 1rem;
        }

        .hero-actions {
            gap: .5rem;
        }

        .hero-meta {
            grid-template-columns: repeat(2, minmax(0, 1fr));
        }
    }

    @@media (max-width: 768px) {
        .hero-actions {
            flex-direction: column;
            align-items: stretch;
        }

        .hero-btn {
            justify-content: center;
        }

        .info-grid {
            grid-template-columns: repeat(2, minmax(140px, 1fr));
        }

        .share-grid {
            grid-template-columns: repeat(2, minmax(120px, 1fr));
        }
    }
</style>

@section Scripts {
    <script>
        @if (hasLocation)
        {
            <text>
        window.initBusinessLocationMap = function () {
            const mapEl = document.getElementById('businessLocationMap');
            if (!mapEl) {
                return;
            }

            const lat = parseFloat(mapEl.dataset.lat);
            const lng = parseFloat(mapEl.dataset.lng);
            const businessName = mapEl.dataset.name || 'İşletme';

            if (Number.isNaN(lat) || Number.isNaN(lng)) {
                return;
            }

            const businessPosition = { lat: lat, lng: lng };

            const map = new google.maps.Map(mapEl, {
                center: businessPosition,
                zoom: 15,
                disableDefaultUI: false,
                mapTypeControl: true,
                streetViewControl: true,
                fullscreenControl: true
            });

            // İşletme marker'ı
            const businessMarker = new google.maps.Marker({
                position: businessPosition,
                map: map,
                title: businessName,
                icon: {
                    path: google.maps.SymbolPath.CIRCLE,
                    scale: 10,
                    fillColor: '#ffc107',
                    fillOpacity: 1,
                    strokeColor: '#fff',
                    strokeWeight: 3
                },
                animation: google.maps.Animation.DROP
            });

            // İşletme bilgi penceresi
            const businessInfoWindow = new google.maps.InfoWindow({
                content: `
                    <div style="padding: 1rem;">
                        <h6 style="margin: 0 0 0.5rem 0; color: #667eea; font-weight: 600;">
                            <i class="fas fa-store me-2"></i>${businessName}
                        </h6>
                        <p style="margin: 0; color: #6c757d; font-size: 0.9rem;">
                            <i class="fas fa-map-marker-alt me-1"></i>İşletme Konumu
                        </p>
                    </div>
                `
            });

            businessMarker.addListener('click', () => {
                businessInfoWindow.open(map, businessMarker);
            });

            // Yakın yerleri göster
            if (window.NearbyPlacesService) {
                window.NearbyPlacesService.showNearbyPlaces(map, businessPosition, businessName, true);
            }
        };
            </text>
        }

        function copyToClipboard() {
            navigator.clipboard.writeText(window.location.href)
                .then(() => alert('Link panoya kopyalandı!'));
        }

        $(document).ready(function () {
            function getToken() {
                return $('input[name="__RequestVerificationToken"]').val() || '';
            }

            $(document).on('click', '.favorite-btn', function (e) {
                e.preventDefault();
                var businessId = $(this).data('business-id');
                var button = $(this);
                var icon = button.find('i');

                if (!businessId) {
                    console.error('Business ID bulunamadı');
                    alert('Bir hata oluştu. Lütfen sayfayı yenileyin.');
                    return;
                }

                var token = getToken();

                $.ajax({
                    url: '@Url.Action("ToggleFavorite", "User")',
                    type: 'POST',
                    data: {
                        businessId: businessId
                    },
                    headers: {
                        'RequestVerificationToken': token
                    },
                    beforeSend: function (xhr) {
                        if (token) {
                            xhr.setRequestHeader('RequestVerificationToken', token);
                        }
                    },
                    success: function (response) {
                        if (response && response.success) {
                            if (response.isFavorite) {
                                icon.removeClass('far').addClass('fas');
                                button.addClass('active');
                                button.attr('title', 'Favorilerden çıkar');
                            } else {
                                icon.removeClass('fas').addClass('far');
                                button.removeClass('active');
                                button.attr('title', 'Favorilere ekle');
                            }
                            var notification = $('<div class="alert alert-success position-fixed top-0 start-50 translate-middle-x mt-3" style="z-index: 9999; min-width: 300px; border-radius: 0.5rem;">' + response.message + '</div>');
                            $('body').append(notification);
                            setTimeout(function () {
                                notification.fadeOut(function () {
                                    $(this).remove();
                                });
                            }, 2000);
                        } else {
                            alert(response ? response.message : 'Bilinmeyen bir hata oluştu');
                        }
                    },
                    error: function (xhr, status) {
                        if (xhr.status === 401 || xhr.status === 403) {
                            alert('Bu işlemi yapmak için giriş yapmanız gerekiyor.');
                        } else if (xhr.status === 400) {
                            var errorMsg = xhr.responseJSON && xhr.responseJSON.message
                                ? xhr.responseJSON.message
                                : 'Geçersiz istek. Lütfen tekrar deneyin.';
                            alert(errorMsg);
                        } else {
                            alert('Bir hata oluştu. Lütfen tekrar deneyin. (Hata: ' + status + ')');
                        }
                    }
                });
            });

            @if (User.Identity.IsAuthenticated)
            {
                <text>
                var businessId = @business.Id;
                $.ajax({
                    url: '@Url.Action("CheckFavorite", "User")',
                    type: 'GET',
                    data: { businessId: businessId },
                    success: function(response) {
                        if (response && response.isFavorite) {
                            $('.favorite-btn').find('i').removeClass('far').addClass('fas');
                            $('.favorite-btn').addClass('active');
                            $('.favorite-btn').attr('title', 'Favorilerden çıkar');
                        }
                    }
                });
                </text>
            }
        });
    </script>
    <script src="~/js/nearby-places.js" asp-append-version="true"></script>
    @if (hasLocation && !string.IsNullOrEmpty(ViewBag.GoogleMapsApiKey as string))
    {
        <script async defer src="https://maps.googleapis.com/maps/api/js?key=@ViewBag.GoogleMapsApiKey&libraries=places&callback=initBusinessLocationMap"></script>
    }
    else if (hasLocation)
    {
        <script>
            document.addEventListener('DOMContentLoaded', function () {
                // OpenStreetMap fallback kullan
                if (window.NearbyPlacesService) {
                    const mapEl = document.getElementById('businessLocationMap');
                    if (mapEl) {
                        const lat = parseFloat(mapEl.dataset.lat);
                        const lng = parseFloat(mapEl.dataset.lng);
                        const businessName = mapEl.dataset.name || 'İşletme';
                        
                        if (!Number.isNaN(lat) && !Number.isNaN(lng)) {
                            // Leaflet ile harita oluştur
                            if (window.L) {
                                const map = L.map(mapEl).setView([lat, lng], 15);
                                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                                    attribution: '© OpenStreetMap contributors',
                                    maxZoom: 19
                                }).addTo(map);
                                
                                L.marker([lat, lng]).addTo(map)
                                    .bindPopup(`<strong>${businessName}</strong>`);
                                
                                // Yakın yerleri göster
                                window.NearbyPlacesService.showNearbyPlaces(map, { lat: lat, lng: lng }, businessName, false);
                            }
                        }
                    }
                }
            });
        </script>
    }
}
